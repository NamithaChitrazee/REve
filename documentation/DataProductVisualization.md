# Data Product Visualization in Mu2e Event Display

This document outlines the purpose and key features of the core C++ functions used in the Mu2e event display to visualize **Monte Carlo (MC)** and **Reconstructed (Reco)** data products. These functions convert abstract data objects into graphical elements using the **ROOT REve** framework, enabling detailed event inspection.

---

## MC Data Visualization

The following function displays simulated particle trajectories.

### $\text{MCInterface::AddMCTrajectoryCollection}$

This function processes collections of $\text{MCTrajectory}$ objects and renders them as colored lines in the detector scene. 

| Feature | Description |
| :--- | :--- |
| **Input** | $\text{MCTrajectoryCollection}$ |
| **Visualization** | **$\text{REveLine}$** for each trajectory. |
| **Color Coding** | Line color is assigned based on the **particle's PDG ID** (e.g., electron is red, muon is black). |
| **Filtering** | Draws only particles whose PDG ID is included in the user-defined $\text{particleIds}$ list. |
| **Title Info** | Includes **Particle Name**, **SimParticle ID**, **Parent ID**, **Kinetic Energy**, and **Creation/Stopping Codes** for traceability. |

### $\text{MCInterface::AddSurfaceStepCollection}$

This function visualizes points where a $\text{SimParticle}$ crosses a defined detector or virtual surface.

| Feature | Description |
| :--- | :--- |
| **Input** | $\text{SurfaceStepCollection}$ |
| **Visualization** | **$\text{REvePointSet}$** marker at the step's $\text{midPosition}$. |
| **Color Coding** | Fixed to **kBlack** (in the current implementation) to distinguish them clearly from track lines. |
| **Filtering** | Draws only steps made by particles whose PDG ID is in the user-defined $\text{particleIds}$ list. |
| **Title Info** | Includes the **Surface ID name**, step **Position**, **Time**, **Momentum**, and **Energy Deposit** ($\text{edep}$). |

---

## Reconstructed (Reco) Data Visualization

These functions visualize the output of track fitting and hit clustering algorithms.

### $\text{DataInterface::FillKinKalTrajectory}$

This is the main orchestration function for visualizing reconstructed tracks ($\text{KalSeed}$) and their associated products.

| Feature | Description |
| :--- | :--- |
| **Input** | $\text{KalSeedPtrCollection}$ |
| **Action** | Identifies the successful fit type ($\text{LoopHelix}$, $\text{CentralHelix}$, $\text{KinematicLine}$) and calls specialized functions to draw the trajectory and products. |
| **Output** | Adds a **$\text{REveCompound}$** (**trackproducts**) to the scene, grouping all elements related to a single track. |
| **Trajectory** | Uses $\text{AddKinKalTrajectory}$ to draw the path based on the chosen fit type. |
| **Products** | Calls $\text{AddTrkStrawHit}$ (for hits) and $\text{AddKalIntersection}$ (for material/surface crossings). |

### $\text{DataInterface::AddKinKalTrajectory}$

Renders the smooth, mathematical path of a **$\text{KinKal}$ track fit**.

| Feature | Description |
| :--- | :--- |
| **Input** | $\text{KinKal}$ Trajectory ($\text{LoopHelix}$, $\text{CentralHelix}$, or $\text{KinematicLine}$) |
| **Visualization** | **$\text{REveLine}$** generated by sampling the trajectory's equation across its time range at discrete steps ($\text{0.1}$ time units). |
| **Title Info** | Includes **Particle Name**, **Momentum**, **Fit Parameters** ($\text{lam}$, $\text{rad}$, $\text{omega}$, $\text{d0}$, $\text{z0}$), and **Fit Consistency**. |

### $\text{DataInterface::AddTrkStrawHit}$

Visualizes the individual $\text{Tracker}$ hits that contributed to a track fit.

| Feature | Description |
| :--- | :--- |
| **Input** | $\text{TrkStrawHitSeed}$s from a $\text{KalSeed}$ |
| **Visualization** | A **$\text{REveCompound}$** containing a **$\text{REvePointSet}$** (the hit position) and a **$\text{REveLine}$** (the $2\sigma$ error bar perpendicular to the track/wire). |
| **Color Coding** | Uses **$\text{TrkHitColor}$** but switches to a **$\text{TrkNoHitColor}$** if the full drift constraint was *not* used in the fit. |

### $\text{DataInterface::AddKalIntersection}$

Marks where the track crosses significant surfaces within the detector geometry.

| Feature | Description |
| :--- | :--- |
| **Input** | $\text{KalIntersection}$ objects from a $\text{KalSeed}$ |
| **Visualization** | **$\text{REvePointSet}$** marker. |
| **Color Coding** | **kViolet** for intersections with material (where $\text{dMom} > 0.0$) and **kYellow** for intersections with virtual surfaces. |
| **Title Info** | **Position**, **Time**, **Momentum/dMomentum**, and the name of the **Surface** intersected. |

### $\text{DataInterface::AddTrkHits}$

Visually links reconstructed tracks to the original hit collections.

| Feature | Description |
| :--- | :--- |
| **Input** | $\text{ComboHitCollection}$ and $\text{KalSeedPtrCollection}$ |
| **Visualization** | **$\text{REvePointSet}$** at the position of each $\text{ComboHit}$. |
| **Functionality** | **Filters** the $\text{ComboHits}$ by comparing their $\text{StrawId}$ against a set of $\text{StrawId}$s used in all $\text{KalSeeds}$. This highlights *only* the hits used for tracking. |
| **Efficiency** | Uses a **$\text{std::set}$** to efficiently check $\text{StrawId}$ membership, preventing slow triple-nested loop searches. |

### $\text{DataInterface::AddTimeClusters}$

Visually displays clusters of hits used to determine the initial time ($\text{t0}$) for track seeds.

| Feature | Description |
| :--- | :--- |
| **Input** | $\text{TimeClusterCollection}$ |
| **Visualization** | **$\text{REvePointSet}$** marker at the cluster's central position. |
| **Title Info** | Cluster $\text{t0}$ and error. |

### $\text{DataInterface::AddCosmicTrackFit}$

Draws the simple straight-line fit for cosmic ray data.

| Feature | Description |
| :--- | :--- |
| **Input** | $\text{CosmicTrackSeedCollection}$ |
| **Visualization** | **$\text{REveLine}$** segment. |
| **Functionality** | Draws a line segment between the calculated track positions corresponding to the **first and last Y-coordinates** of the hits used in the fit. |
